dev.probaland.ru {
  log {
    format json
  }

  # Компрессия
  encode zstd gzip

  # Самоподписной сертификат для внутренних подключений 
  tls internal

  # Проверка здоровья сервиса
  @health {
    path /health
  }
  respond @health 200

  # Проксирование к backend
  handle /api/* {
    # Вырезаем префикс /api/ во время передачи данных в бэк,
    # Так надо потому что бэк не был настроен на работу через префикс
    uri strip_prefix /api
    # Проксирование контейнера
    reverse_proxy backend:3005 {
      header_up Host {host}
      header_up X-Real-IP {remote}
      header_up X-Forwarded-For {remote}
      header_up X-Forwarded-Proto {scheme}
    }
  }

  # Проксирование к frontend
  handle {
    reverse_proxy frontend:8080 {
      header_up Host {host}
      header_up X-Real-IP {remote}
      header_up X-Forwarded-For {remote}
      header_up X-Forwarded-Proto {scheme}
    }
  }
}

# api.probaland.ru {
#   log {
#     format json
#   }

#   # Компрессия
#   encode zstd gzip

#   # Самоподписной сертификат для внешних подключений
#   tls internal

#   # Проверка здоровья сервиса
#   @health {
#     path /health
#   }
#   respond @health 200

#   # Проксирование к backend
#   reverse_proxy backend:3005 {
#     header_up Host {host}
#     header_up X-Real-IP {remote}
#     header_up X-Forwarded-For {remote}
#     header_up X-Forwarded-Proto {scheme}
#   }
# }